{% extends 'base.html' %}

{% load static %}

{%block content%}
{% comment %} {% extends 'base.html' %}
{% load static %}

{%block content%}



<article class="accordion" id="accordion_pay">
	<div class="card">
		<header class="card-header">
			<img src="./images/misc/payment-paypal.png" class="float-right" height="24"> 
			<label class="form-check collapsed" data-toggle="collapse" data-target="#pay_paynet">
				<input class="form-check-input" name="payment-option" checked type="radio" value="cod">
				<h6 class="form-check-label"> 
					Cash on delivery 
				</h6>
			</label>
		</header>

	</div> <!-- card.// -->
	<div class="card">
	<header class="card-header">
		<img src="./images/misc/payment-card.png" class="float-right" height="24">  
		<label class="form-check" data-toggle="collapse" data-target="#pay_payme">
			<input class="form-check-input" name="payment-option" type="radio" value="card">
			<h6 class="form-check-label"> Credit/Debit Card  </h6>
		</label>
	</header>
	<div id="pay_payme" class="collapse" data-parent="#accordion_pay">
		<div class="card-body">
			<p class="alert alert-success">Some information or instruction</p>
			<form class="form-inline">
				<input type="text" class="form-control mr-2" placeholder="xxxx-xxxx-xxxx-xxxx" name="">
				<input type="text" class="form-control mr-2" style="width: 100px"  placeholder="dd/yy" name="">
				<input type="number" maxlength="3" class="form-control mr-2"  style="width: 100px"  placeholder="cvc" name="">
				<button class="btn btn btn-success">Button</button>
			</form>
		</div> <!-- card body .// -->
	</div> <!-- collapse .// -->
	</div> <!-- card.// -->
	
</article> 
<!-- accordion end.// -->
  
		</main> <!-- col.// -->
		<aside class="col-md-4">
			<div class="card">
		<div class="card-body">
			<dl class="dlist-align">
			  <dt>Total price:</dt>
			  <dd class="text-right">$69.97</dd>
			</dl>
			<dl class="dlist-align">
			  <dt>Tax:</dt>
			  <dd class="text-right"> $10.00</dd>
			</dl>
			<dl class="dlist-align">
			  <dt>Total:</dt>
			  <dd class="text-right text-dark b"><strong>$59.97</strong></dd>
			</dl>
			<hr>
			<p class="text-center mb-3">
				<img src="./images/misc/payments.png" height="26">
			</p>
			<a href="./place-order.html" class="btn btn-primary btn-block"> Place Order </a>
			
		</div> <!-- card-body.// -->
		</div> <!-- card.// -->
		</aside> <!-- col.// -->
	</div> <!-- row.// -->

<!-- ============================ COMPONENT 2 END//  ================================= -->




</div> <!-- container .//  -->
</section>
<!-- ========================= SECTION CONTENT END// ========================= -->


{% endblock %} {% endcomment %}





		<div class="breadcrumbs">
			<div class="container">
				<div class="row">
					<div class="col">
						<p class="bread"><span><a href="index.html">Home</a></span> / <span>Payment</span></p>
					</div>
				</div>
			</div>
		</div>


		<div class="colorlib-product">
			<div class="container">
				<!-- <div class="row row-pb-lg">
					<div class="col-sm-10 offset-md-1">
						<div class="process-wrap">
							<div class="process text-center active">
								<p><span>01</span></p>
								<h3>Shopping Cart</h3>
							</div>
							<div class="process text-center active">
								<p><span>02</span></p>
								<h3>Checkout</h3>
							</div>
							<div class="process text-center">
								<p><span>03</span></p>
								<h3>Order Complete</h3>
							</div>
						</div>
					</div>
				</div> -->
				<div class="row">
					<div class="col-lg-8">
						<!-- <div class="colorlib-form"> --><br>
							<h6>Shipping to:</h6>
		              	<div class="row">

			            	<div class="col-md-12">
			                  <!-- <div class="form-group"> -->
								
                                <h5>{{address.name}}</h5>
								<p>{{address.house_name}}, {{address.address_line_1}}, {{address.city}}, {{address.state}},<br>{{address.country}},{{address.pincode}}, <br> {{address.phone}}</p>
								
			                  	  
			                  <!-- </div> -->
			               </div>
		               </div>
						<!-- </div> -->
					</div>

					<div class="col-lg-4">
						<div class="row">
							<div class="col-md-12">
								<div class="cart-detail">
									<h4>Cart Total</h4>
									<ul>
										<h5><span>Total Items: </span> <span>{{total}}</span></h5>

										
											
										</li>
										<!-- <li><span>Shipping Fee</span> <span>â‚¹0.00</span></li> -->
										<h5><span>Order Total: </span> <span id="total_price"> ${{sum}}</span></h5>
									</ul>
								</div>
						   </div>

						   <div class="w-100"></div>

						
						</div>
					</div>
				</div>
                <div class="row">
                    <div class="col-lg-8">
						<!-- <div class="colorlib-form"> -->
							<br>
							<h4>Payment Method</h4>
		              	<div class="row">
							

			            	<div class="col-md-12">
			                  <!-- <div class="form-group"> -->
{% comment %}                                 
                                <div class="payment-section">
                                    
                                    <select class= "" id="myDropdown ">
                                      <option value="">Payment Method</option>
                                      <option value="cod">COD</option>
                                      <option value="razorpay">Razorpay</option> 
                                    </select>
                                  </div> {% endcomment %}

								  {% if flag == 1 %}
								  <p><a role="button" class="wallet_pay btn btn-warning mt-3">Pay using Wallet</a></p> 
								  {% endif %}

								  
								  <a href="{% url 'place_order' id=address.id payment_method='COD'%}" > <button class="submit place_order btn btn-success" ><span>COD  </span></button></a>
								<p><a href="{% url 'confirm_payment_page' address.id  %}" role="button" class="proceed_button btn btn-primary rounded-0 mt-3" onclick="showPopup()">Confirm Order with Razorpay</a></p> 

                               <!-- Pop-up overlay -->
                                <div id="overlay" class="overlay" style="display:none;">
                                    
                                    <div id="popup" class="popup" style="background-color: #4BB543; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                                        <h2 class="text-center">Order Confirmed!</h2> 
                                        <p class="text-center">Your order has been successfully placed.</p>
                                        <a class="btn btn-secondary center" href="{% url 'home' %}">Close</a>
                                     </div>
                                    </div>

			                  <!-- </div> -->
			               </div>
							
		               </div>
						<!-- </div> -->
					</div>
                    
                </div>
			</div>
		</div>
		<input type="hidden" id="cod_orderid" value="{{id}}">

        <script>
			placeOrderButton = document.getElementById('place-order-button');
            $(document).ready(function() {
				// Event listener for payment method selection
				$("#myDropdown").on("change", function() {
					console.log("changed")
					var selectedOption = $(this).val();
					console.log("Selected Payment Method: " + selectedOption);
					// Perform actions based on the selected payment method
				});
			
				// Event listener for "Place Order" button click
				$(".proceed_button").on('click', function() {
					console.log("Place Order button clicked");
					var selectedOption = $("#myDropdown").val();
					console.log("kkk"selectedOption)
					var defaultAddressId = "{{ adds.id }}";  // Retrieve the default address ID from the Django template variable
			
					// Make an AJAX request to place the order
					$.ajax({
						type: "GET",
						url: "",  // Replace 'place_order' with the actual URL of your view
						data: {
							'selectedOption': selectedOption,
							'defaultAddressId': defaultAddressId,
						},
						success: function(data) {
							console.log("AJAX request success");
							console.log("Flag: " + data.flag);
							flag = data.flag;
							console.log("Message: " + data.message);
			
							if (data.redirect) {
								console.log("Redirecting to: " + data.redirect);
								window.location.href = data.redirect;
							}
			
							// Call the displayPopup() function here if needed
							// displayPopup();
						},
						error: function(xhr, textStatus, errorThrown) {
							console.error("AJAX request failed");
							console.error("Status: " + textStatus);
							console.error("Error: " + errorThrown);
						}
					});
				});
			
				// Functions for displaying and closing the popup
				function displayPopup() {
					var overlay = $("#overlay");
					var popup = $("#popup");
					overlay.show();
					popup.show();
				}
			
				function closePopup() {
					var overlay = $("#overlay");
					var popup = $("#popup");
					overlay.hide();
					popup.hide();
				}
			});
			

        </script>




     {% endblock %}