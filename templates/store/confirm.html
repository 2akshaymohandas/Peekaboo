{% extends 'base.html' %}

{% load static %}

{%block content%}
{% comment %} {% extends 'base.html' %}
{% load static %}

{%block content%}



<article class="accordion" id="accordion_pay">
	<div class="card">
		<header class="card-header">
			<img src="./images/misc/payment-paypal.png" class="float-right" height="24"> 
			<label class="form-check collapsed" data-toggle="collapse" data-target="#pay_paynet">
				<input class="form-check-input" name="payment-option" checked type="radio" value="cod">
				<h6 class="form-check-label"> 
					Cash on delivery 
				</h6>
			</label>
		</header>

	</div> <!-- card.// -->
	<div class="card">
	<header class="card-header">
		<img src="./images/misc/payment-card.png" class="float-right" height="24">  
		<label class="form-check" data-toggle="collapse" data-target="#pay_payme">
			<input class="form-check-input" name="payment-option" type="radio" value="card">
			<h6 class="form-check-label"> Credit/Debit Card  </h6>
		</label>
	</header>
	<div id="pay_payme" class="collapse" data-parent="#accordion_pay">
		<div class="card-body">
			<p class="alert alert-success">Some information or instruction</p>
			<form class="form-inline">
				<input type="text" class="form-control mr-2" placeholder="xxxx-xxxx-xxxx-xxxx" name="">
				<input type="text" class="form-control mr-2" style="width: 100px"  placeholder="dd/yy" name="">
				<input type="number" maxlength="3" class="form-control mr-2"  style="width: 100px"  placeholder="cvc" name="">
				<button class="btn btn btn-success">Button</button>
			</form>
		</div> <!-- card body .// -->
	</div> <!-- collapse .// -->
	</div> <!-- card.// -->
	
</article> 
<!-- accordion end.// -->
  
		</main> <!-- col.// -->
		<aside class="col-md-4">
			<div class="card">
		<div class="card-body">
			<dl class="dlist-align">
			  <dt>Total price:</dt>
			  <dd class="text-right">$69.97</dd>
			</dl>
			<dl class="dlist-align">
			  <dt>Tax:</dt>
			  <dd class="text-right"> $10.00</dd>
			</dl>
			<dl class="dlist-align">
			  <dt>Total:</dt>
			  <dd class="text-right text-dark b"><strong>$59.97</strong></dd>
			</dl>
			<hr>
			<p class="text-center mb-3">
				<img src="./images/misc/payments.png" height="26">
			</p>
			<a href="./place-order.html" class="btn btn-primary btn-block"> Place Order </a>
			
		</div> <!-- card-body.// -->
		</div> <!-- card.// -->
		</aside> <!-- col.// -->
	</div> <!-- row.// -->

<!-- ============================ COMPONENT 2 END//  ================================= -->




</div> <!-- container .//  -->
</section>
<!-- ========================= SECTION CONTENT END// ========================= -->


{% endblock %} {% endcomment %}





		<div class="breadcrumbs">
			<div class="container">
				<div class="row">
					<div class="col">
						<p class="bread"><span><a href="index.html">Home</a></span> / <span>Payment</span></p>
					</div>
				</div>
			</div>
		</div>


		<div class="colorlib-product">
			<div class="container">
				<!-- <div class="row row-pb-lg">
					<div class="col-sm-10 offset-md-1">
						<div class="process-wrap">
							<div class="process text-center active">
								<p><span>01</span></p>
								<h3>Shopping Cart</h3>
							</div>
							<div class="process text-center active">
								<p><span>02</span></p>
								<h3>Checkout</h3>
							</div>
							<div class="process text-center">
								<p><span>03</span></p>
								<h3>Order Complete</h3>
							</div>
						</div>
					</div>
				</div> -->
				<div class="row">
					<div class="col-lg-8">
						<!-- <div class="colorlib-form"> --><br>
							<h6>Shipping to:</h6>
		              	<div class="row">

			            	<div class="col-md-12">
			                  <!-- <div class="form-group"> -->
								
                                <h5>{{address.name}}</h5>
								<p>{{address.house_name}}, {{address.address_line_1}}, {{address.city}}, {{address.state}},<br>{{address.country}},{{address.pincode}}, <br> {{address.phone}}</p>
								
			                  	  
			                  <!-- </div> -->
			               </div>
		               </div>
						<!-- </div> -->
					</div>

					<div class="col-lg-4">
						<div class="row">
							<div class="col-md-12">
								<div class="cart-detail">
									<h4>Cart Total</h4>
									<ul>
										<h5><span>Total Items: </span> <span>{{total}}</span></h5>

										
											
										</li>
										<!-- <li><span>Shipping Fee</span> <span>â‚¹0.00</span></li> -->
										<h5><span>Order Total: </span> <span id="total_price"> ${{sum}}</span></h5>
									</ul>
								</div>
						   </div>

						   <div class="w-100"></div>

						
						</div>
					</div>
				</div>
                <div class="row">
                    <div class="col-lg-8">
						<!-- <div class="colorlib-form"> -->
							<br>
							<h4>Payment Method</h4>
		              	<div class="row">
							

			            	<div class="col-md-12">
			                  <!-- <div class="form-group"> -->
{% comment %}                                 
                                <div class="payment-section">
                                    
                                    <select class= "" id="myDropdown ">
                                      <option value="">Payment Method</option>
                                      <option value="cod">COD</option>
                                      <option value="razorpay">Razorpay</option> 
                                    </select>
                                  </div> {% endcomment %}

								  {% if flag == 1 %}
								  <p><a role="button" class="wallet_pay btn btn-warning mt-3">Pay using Wallet</a></p> 
								  {% endif %}

								  
                                </div>
                                <div class="card-footer bg-transparent border-success"><button id="rzp-button1" class="btn btn-success" payment='Razorpay'>Pay with Razorpay</button></div>
                              </div>

                               <!-- Pop-up overlay -->
                                <div id="overlay" class="overlay" style="display:none;">
                                    
                                    <div id="popup" class="popup" style="background-color: #4BB543; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                                        <h2 class="text-center">Order Confirmed!</h2> 
                                        <p class="text-center">Your order has been successfully placed.</p>
                                        <a class="btn btn-secondary center" href="{% url 'home' %}">Close</a>
                                     </div>
                                    </div>

			                  <!-- </div> -->
			               </div>
							
		               </div>
						<!-- </div> -->
					</div>
                    
                </div>
			</div>
		</div>
		<input type="hidden" id="cod_orderid" value="{{id}}">

        <script>
			placeOrderButton = document.getElementById('place-order-button');
            $(document).ready(function() {
				// Event listener for payment method selection
				$("#myDropdown").on("change", function() {
					console.log("changed")
					var selectedOption = $(this).val();
					console.log("Selected Payment Method: " + selectedOption);
					// Perform actions based on the selected payment method
				});
			
				// Event listener for "Place Order" button click
				$(".proceed_button").on('click', function() {
					console.log("Place Order button clicked");
					var selectedOption = $("#myDropdown").val();
					console.log("kkk"selectedOption)
					var defaultAddressId = "{{ adds.id }}";  // Retrieve the default address ID from the Django template variable
			
					// Make an AJAX request to place the order
					$.ajax({
						type: "GET",
						url: "",  // Replace 'place_order' with the actual URL of your view
						data: {
							'selectedOption': selectedOption,
							'defaultAddressId': defaultAddressId,
						},
						success: function(data) {
							console.log("AJAX request success");
							console.log("Flag: " + data.flag);
							flag = data.flag;
							console.log("Message: " + data.message);
			
							if (data.redirect) {
								console.log("Redirecting to: " + data.redirect);
								window.location.href = data.redirect;
							}
			
							// Call the displayPopup() function here if needed
							// displayPopup();
						},
						error: function(xhr, textStatus, errorThrown) {
							console.error("AJAX request failed");
							console.error("Status: " + textStatus);
							console.error("Error: " + errorThrown);
						}
					});
				});
			
				// Functions for displaying and closing the popup
				function displayPopup() {
					var overlay = $("#overlay");
					var popup = $("#popup");
					overlay.show();
					popup.show();
				}
			
				function closePopup() {
					var overlay = $("#overlay");
					var popup = $("#popup");
					overlay.hide();
					popup.hide();
				}
			});
			

        </script>

        <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
        <script>
            var options = {
                "key": "rzp_test_FWMMF1JKBSbSTR", // Enter the Key ID generated from the Dashboard
                "amount": "{{payment.amount}}", // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
                "currency": "INR",
                "name": "Peekaboo",
                "description": "Test Transaction",
                "image": "https://example.com/your_logo",
                //"order_id": "order_IluGWxBm9U8zJ8", //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
                "handler": function (response){
                    //alert(response.razorpay_payment_id);
                    //alert(response.razorpay_order_id);
                    //alert(response.razorpay_signature)
                    window.location.href = "{% url 'place_order' id=address.id payment_method='Online' %}";
                },
                
                "theme": {
                    "color": "#3399cc"
                }
            };
            var rzp1 = new Razorpay(options);
            rzp1.on('payment.failed', function (response){
                    alert(response.error.code);
                    alert(response.error.description);
                    alert(response.error.source);
                    alert(response.error.step);
                    alert(response.error.reason);
                    alert(response.error.metadata.order_id);
                    alert(response.error.metadata.payment_id);
            });
            document.getElementById('rzp-button1').onclick = function(e){
                rzp1.open();
                e.preventDefault();
            }
            </script>


     {% endblock %}